# PSM-R
Propensity Score Matching (PSM) for Coliform Levels and Population Growth in R
# Summary
This repository demonstrates how to apply Propensity Score Matching (PSM) to analyze the causal effect of population growth on coliform levels at various monitoring stations. The dataset contains time series data from eight stations, and the analysis aims to determine whether population growth has a significant impact on coliform concentrations.
# Steps
Data Preprocessing: Handling missing values, normalizing coliform data, and creating a treatment indicator based on population growth thresholds.
Propensity Score Calculation: Using logistic regression to estimate propensity scores, which represent the likelihood of high population growth given the coliform levels.
Matching: Matching observations from high population growth periods (treatment group) with those from low or no population growth periods (control group) based on their propensity scores.
ATT Calculation: Calculating the Average Treatment Effect on the Treated (ATT) to measure the impact of population growth on coliform concentrations.
Visualization: Plotting the ATT results to visualize the effect across multiple stations.

# Repository Structure
data/: Contains the raw coliform and population data.
scripts/: R scripts for data preprocessing, PSM, and visualization.
output/: Contains the matched data and visualizations generated by the analysis.
# Requirements
Ensure the following R packages are installed:
MatchIt: For Propensity Score Matching
dplyr: For data manipulation
ggplot2: For visualization
You can install these packages in R using:
install.packages(c("MatchIt", "dplyr", "ggplot2"))
# My Workflow
#Install and load necessary packages
install.packages("MatchIt")   # For Propensity Score Matching
install.packages("dplyr")     # For data manipulation
install.packages("ggplot2")   # For plotting

# Load the libraries
library(MatchIt)
library(dplyr)
library(ggplot2)

# Load my data
# Adjust the file path as per your setup
data <- read.csv("C:/Users/KEMI/Desktop/stationsdatapredictions.csv")

# Clean up unnecessary columns (e.g., 'Unnamed: 0')
# Check the structure of the data to ensure correct column names
str(data)

# If there are unwanted columns, remove them (e.g., Unnamed: 0)
if ("Unnamed: 0" %in% colnames(data)) {
  data <- data %>% select(-Unnamed..0)
}
# Create the treatment indicator variable based on population growth
# Calculate the 75th percentile threshold for high population growth
high_growth_threshold <- quantile(data$Population, 0.75, na.rm = TRUE)

# Create the treatment variable (1 for high growth, 0 for low/no growth)
data <- data %>%
  mutate(Treatment = ifelse(Population > high_growth_threshold, 1, 0))

# Perform Propensity Score Matching using the MatchIt package
# Match based on the selected covariates (e.g., Q, G, J, etc.)
psm_model <- matchit(Treatment ~ Q + G + J + N + P + B + D + E, 
                     data = data, 
                     method = "nearest", 
                     distance = "logit")
#Step 6: Summarize the PSM results and get the matched data
summary(psm_model)

# Get the matched data
matched_data <- match.data(psm_model)

# Filter the matched data into treatment and control groups
treatment_group <- matched_data %>% filter(Treatment == 1)
control_group <- matched_data %>% filter(Treatment == 0)

# Calculate the ATT (Average Treatment Effect on the Treated)
# Calculate the mean values for each station in treatment and control groups
mean_treatment <- treatment_group %>% summarise(across(c(Q, G, J, N, P, B, D, E), mean))
mean_control <- control_group %>% summarise(across(c(Q, G, J, N, P, B, D, E), mean))

# Calculate ATT as the difference between the two groups
ATT <- mean_treatment - mean_control

# Convert ATT to numeric values if necessary
att_values <- as.numeric(ATT)

# Print the ATT values
print("Average Treatment Effect on the Treated (ATT):")
print(ATT)

# Plot the ATT values using ggplot2
# Define station names
stations <- c("Q", "G", "J", "N", "P", "B", "D", "E")

# Create a bar plot to visualize the ATT for each station
ggplot(data = data.frame(Station = stations, ATT = att_values), aes(x = Station, y = ATT)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  theme_minimal() +
  labs(title = "Average Treatment Effect on the Treated (ATT) by Station",
       y = "ATT (Coliform Concentration Difference)", x = "Station")


# Create a bar plot to visualize the ATT for each station with custom styling and no title
ggplot(data = data.frame(Station = stations, ATT = att_values), aes(x = Station, y = ATT)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  theme_minimal() +
  labs(y = "ATT (Coliform Concentration Difference)", x = "Station") +  # Only specify X and Y labels
  theme(
    panel.grid = element_blank(),   # Remove gridlines
    panel.border = element_rect(color = "black", fill = NA, size = 1),  # Add borders around the plot
    axis.line = element_line(color = "black", size = 1)  # Add axis lines for X and Y axes
  )

# Interpretation
The analysis shows which stations are most impacted by population growth, based on the calculated ATT values. Positive ATT values indicate an increase in coliform levels due to high population growth, while negative or zero values suggest minimal or no effect.

